{% extends 'layout.html' %}

{% block title %}
Moje faktury
{% endblock%}

{% block content %}
    
    <div class="container">
      <h1>Moje faktury</h1>

      {% if invoices|length > 0 %}
      <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th>Numer faktury</th>
                <th>Nazwa firmy</th>
                <th>NIP firmy</th>
                <th>Netto</th>
                <th>Brutto</th>
                <th>Akcje</th>
              </tr>
            </thead>
            <tbody>
         {% for invoice in invoices %}
         
              <tr>
                <td>{{invoice['invoice_number']}}</td>
                <td>{{invoice['buyer_name']}}</td>
                <td>{{invoice['buyer_nip']}}</td>
                <td>{{invoice['netto']}}</td>
                <td>{{invoice['brutto']}}</td>
                <td>
                  <a href="/moje-faktury/{{invoice['_id']}}" class="btn btn-warning">
                    <i class="bi bi-eye-fill"></i></a>
                  <a href="/generate-docx/{{invoice['_id']}}" class="btn btn-info">
                    <i class="bi bi-download"></i></a>
                  <a href="/edytuj-fakture/{{invoice['_id']}}" class="btn btn-primary">
                    <i class="bi bi-pen-fill"></i></a>
                  

                
                  <button class="deleteBtn btn btn-danger" data-invoice-id="{{invoice['_id']}}" type="button"  data-bs-toggle="modal" data-bs-target="#exampleModal">
                    <i class="bi bi-trash3"></i>
                  </button>
                  
                </td>

              </tr>
         {% endfor %}
            </tbody>
      </table>

      {% else %}
       <p>Nie znaleziono faktur</p>
      {% endif %}
     </div>

      <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample" aria-controls="offcanvasExample">
        Button with data-bs-target
      </button>
      
      <div class="offcanvas offcanvas-start {% if is_error == True %}show{% endif %}" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
        <div class="offcanvas-header">
          <h5 class="offcanvas-title" id="offcanvasExampleLabel">Offcanvas</h5>
          <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
          <form method="post" novalidate>
            {{form.hidden_tag()}}

            {% for field in form %}
            <div class= "form-group">
                {{field.label(class='form-control-label')}}
                {{field(class='form-control')}}
                {% for error in field.errors %}
                 <span style="color:red">{{error}}</span>
                {%endfor%}
            </div>
            {% endfor %}
          </form>
        </div>
        </div>

        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">
                    Potwierdź
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <p>Czy napewno chcesz usunąć fakturę?</p>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Anuluj</button>
                <a id="toDelete" class="btn btn-danger" href="">Usuń</a>
              </div>
            </div>
          </div>
        </div>

        <script>

          const deleteButtons = document.querySelectorAll(".deleteBtn");
          deleteButtons.forEach((x) => {
            x.addEventListener("click", () => {
              const invoiceId = x.getAttribute('data-invoice-id')
              const anchor = document.querySelector("#toDelete")
              anchor.href = `/delete-invoice/${invoiceId}`
            })
          })
  
        </script>
        
{% endblock %}